{"ast":null,"code":"'use strict';\n\nvar _createForOfIteratorHelper = require(\"/Users/mikebannoura/Dropbox/My Mac (MacBook-Pro-Mike.local)/Desktop/mmbball-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createForOfIteratorHelper\");\n\nvar _regeneratorRuntime = require(\"/Users/mikebannoura/Dropbox/My Mac (MacBook-Pro-Mike.local)/Desktop/mmbball-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/Users/mikebannoura/Dropbox/My Mac (MacBook-Pro-Mike.local)/Desktop/mmbball-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _classCallCheck = require(\"/Users/mikebannoura/Dropbox/My Mac (MacBook-Pro-Mike.local)/Desktop/mmbball-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/mikebannoura/Dropbox/My Mac (MacBook-Pro-Mike.local)/Desktop/mmbball-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _assertThisInitialized = require(\"/Users/mikebannoura/Dropbox/My Mac (MacBook-Pro-Mike.local)/Desktop/mmbball-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/assertThisInitialized\");\n\nvar _inherits = require(\"/Users/mikebannoura/Dropbox/My Mac (MacBook-Pro-Mike.local)/Desktop/mmbball-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"/Users/mikebannoura/Dropbox/My Mac (MacBook-Pro-Mike.local)/Desktop/mmbball-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createSuper\");\n\nvar Cursor = require('./cursor');\n\nvar Fragment = require('./fragment');\n\nvar ops = require('./ops');\n\nvar PDF = require('./object');\n\nvar Readable = require('readable-stream');\n\nvar _require = require('uuid'),\n    uuidv4 = _require.v4;\n\nvar util = require('./util');\n\nvar ContentChunk = require('./content');\n\nvar ExternalDocument = require('./external');\n\nvar Font = require('./font/base'); // constants\n\n\nvar RESOLVE = Promise.resolve();\n\nvar Document = /*#__PURE__*/function (_Readable) {\n  _inherits(Document, _Readable);\n\n  var _super = _createSuper(Document);\n\n  function Document(opts) {\n    var _this;\n\n    _classCallCheck(this, Document);\n\n    if (!opts) {\n      opts = {};\n    } // readable stream options\n\n\n    _this = _super.call(this, {\n      highWaterMark: opts.highWaterMark || 16384 // 16kB\n\n    });\n    _this.version = '1.6';\n    _this.info = Object.assign({}, opts.properties, {\n      id: uuidv4()\n    });\n    _this.width = opts.width || 595.296;\n    _this.height = opts.height || 841.896;\n    _this._nextObjectId = 1;\n    _this._xref = new PDF.Xref();\n    _this._reading = false; // wheater someone is reading data from the underlying Readable\n\n    _this._length = 0; // keeps track of the total document length (in byte)\n    // header\n\n    var header = \"%PDF-\".concat(_this.version, \"\\n\") // The PDF format mandates that we add at least 4 commented binary characters\n    // (ASCII value >= 128), so that generic tools have a chance to detect\n    // that it's a binary file\n    + '%\\xFF\\xFF\\xFF\\xFF\\n\\n'; // a backlog of pending operations\n\n    _this._pending = [function () {\n      return _this._write(header);\n    }]; // this is the current operation that is executed (operations are executed sequentially)\n\n    _this._pending.current = null; // init default styling opts\n\n    _this.defaultFont = opts.font || require('../font/Helvetica');\n    _this.defaultFontSize = opts.fontSize || 11;\n    _this.defaultColor = opts.color && util.colorToRgb(opts.color) || [0, 0, 0];\n    _this.defaultLineHeight = opts.lineHeight || 1.15;\n\n    if (!Font.isFont(_this.defaultFont)) {\n      throw new TypeError('opts.font must be set to a valid default font');\n    } // create document and page font dict\n\n\n    _this._fonts = {};\n    _this._xobjects = {};\n    _this._pageFonts = {};\n    _this._annotations = []; // these properties are used to keep track of used Font and Image objects and assign ids to\n    // them in a document-scoped way\n\n    _this._aliases = new AliasGenerator();\n    _this._mapping = new WeakMap(); // a page could consist out of multiple content chunks, which are keept track of using the\n    // following properties\n\n    _this._currentContent = null;\n    _this._contents = [];\n    _this._contentObjCreator = null; // this array can be used to register callbacks that are executed when finalizing the document\n    // e.g. rendering the total page count\n\n    _this._finalize = [];\n    _this._header = _this._footer = _this._template = null; // init cursor\n    // TODO: test for valid values\n\n    var padding = opts.padding >= 0 ? opts.padding : 20;\n    _this.paddingTop = util.defaults(opts.paddingTop, padding);\n    _this.paddingBottom = util.defaults(opts.paddingBottom, padding);\n    _this.paddingLeft = util.defaults(opts.paddingLeft, padding);\n    _this.paddingRight = util.defaults(opts.paddingRight, padding);\n    _this._cursor = new Cursor(_this.width - _this.paddingLeft - _this.paddingRight, _this.height - _this.paddingTop - _this.paddingBottom, // width, height\n    _this.paddingLeft, _this.height - _this.paddingTop // x, y\n    ); // init pages catalog\n\n    _this._pages = new PDF.Array();\n    _this._pagesObj = new PDF.Object('Pages');\n\n    _this._registerObject(_this._pagesObj); // init destinations name tree\n\n\n    _this._destinations = new PDF.NameTree(); // init outlines hierarchy\n\n    _this._outlines = []; // init color space\n\n    _this._colorSpace = new PDF.Object();\n    var iccProfile = require('./sRGB_IEC61966-2-1_black_scaled') + '~>';\n    _this._colorSpace.content = 'stream\\n' + iccProfile + '\\nendstream\\n';\n\n    _this._colorSpace.prop('Length', iccProfile.length);\n\n    _this._colorSpace.prop('N', 3);\n\n    _this._colorSpace.prop('Alternate', 'DeviceRGB'); // this._colorSpace.prop('Filter', new PDF.Array([\n    //   new PDF.Name('ASCII85Decode'), new PDF.Name('FlateDecode')\n    // ]))\n\n\n    _this._colorSpace.prop('Filter', new PDF.Name('ASCII85Decode'));\n\n    _this._registerObject(_this._colorSpace);\n\n    _this._currentColorSpace = '/CS1'; // start to work the _pending queue\n\n    _this._next();\n\n    Fragment.prototype._init.call(_assertThisInitialized(_this), _assertThisInitialized(_this), _assertThisInitialized(_this));\n\n    return _this;\n  } /// private API\n\n\n  _createClass(Document, [{\n    key: \"_next\",\n    value: function _next() {\n      var _this2 = this;\n\n      // return if there is already an operation worked on\n      if (this._pending.current) {\n        return this._pending.current;\n      } // variables used to traverse the nested queue\n\n\n      var parent = this._pending;\n      var next = parent[0]; // if there is nothing in the queue, we are done here\n\n      if (!next) {\n        return RESOLVE;\n      } // the operation queue is a nested array, e.g.: [op1, [op2, op3, [ op4 ]], op5]\n      // it is therefore necessary traverse the first element until the first non array element\n      // is encountered\n\n\n      while (Array.isArray(next)) {\n        // if the first element is an empty array, remove it and start over\n        if (next.length === 0) {\n          parent.shift();\n          return this._next();\n        }\n\n        parent = next;\n        next = next[0];\n      } // remove next from the queue\n\n\n      parent.shift(); // TODO: still necessary?\n      // if (!next) {\n      //   return this._next()\n      // }\n      // return and set the current operation that is being executed\n\n      return this._pending.current = next().then(function () {\n        // once the execution finished, continue in the queue\n        _this2._pending.current = null;\n        return _this2._next();\n      });\n    } // This is method is used by Node.js stream.Readable class, which we inherit from.\n    // The method is called, if data is available from the resource, which means that we should\n    // start pushing data into the read queue (using `this.push(dataChunk)`). It should continue\n    // reading from the resoruce and pushing data until `this.push()` return `false`. Only when it\n    // is called again aft it has stopped should it resume pushing additional data onto the\n    // read queue.\n\n  }, {\n    key: \"_read\",\n    value: function _read()\n    /* size */\n    {\n      this._reading = true;\n      this.emit('read');\n    } // This method is used to push data onto the read queue. If the Readable stream is currently\n    // not read from, the writing is postponed.\n\n  }, {\n    key: \"_write\",\n    value: function _write(chunk) {\n      var _this3 = this;\n\n      if (this._reading) {\n        if (!this.push(chunk, 'binary')) {\n          this._reading = false;\n        }\n\n        this._length += chunk.length;\n        return RESOLVE;\n      } else {\n        return new Promise(function (resolve) {\n          _this3.once('read', function () {\n            resolve(_this3._write(chunk));\n          });\n        });\n      }\n    }\n  }, {\n    key: \"_useFont\",\n    value: function _useFont(font) {\n      var alias;\n\n      if (this._mapping.has(font)) {\n        alias = this._mapping.get(font); // if the alias exists but is now blocked (e.g. because of having set a new template with\n        // colliding aliases), remove the mapping and unset the alias to force creation of a new one\n\n        if (this._aliases.isBlocked(alias)) {\n          this._mapping.delete(font);\n\n          alias = undefined;\n        }\n      }\n\n      if (!alias) {\n        alias = new PDF.Name(this._aliases.next('F'));\n\n        this._mapping.set(font, alias);\n\n        var fontObj = new PDF.Object('Font');\n        this._fonts[alias] = {\n          f: font.instance(),\n          o: fontObj\n        };\n\n        this._registerObject(fontObj);\n      }\n\n      if (this._currentContent && !(alias in this._currentContent._fonts)) {\n        this._currentContent._fonts[alias] = this._fonts[alias].o.toReference();\n      }\n\n      return alias;\n    }\n  }, {\n    key: \"_fontAlias\",\n    value: function _fontAlias(instance) {\n      return this._useFont(instance.parent);\n    }\n  }, {\n    key: \"_fontInstance\",\n    value: function _fontInstance(font) {\n      return this._fonts[this._useFont(font)].f;\n    }\n  }, {\n    key: \"_useXObject\",\n    value: function _useXObject(xobj) {\n      var alias;\n\n      if (this._mapping.has(xobj)) {\n        alias = this._mapping.get(xobj); // if the alias exists but is now blocked (e.g. because of having set a new template with\n        // colliding aliases), remove the mapping and unset the alias to force creation of a new one\n\n        if (this._aliases.isBlocked(alias)) {\n          this._mapping.delete(xobj);\n\n          alias = undefined;\n        }\n      }\n\n      if (!alias) {\n        alias = new PDF.Name(this._aliases.next('X'));\n\n        this._mapping.set(xobj, alias);\n\n        var xobjObjs = [];\n\n        for (var i = 0; i < xobj.xobjCount; ++i) {\n          var xobjObj = new PDF.Object('XObject');\n\n          this._registerObject(xobjObj);\n\n          xobjObjs.push(xobjObj);\n        }\n\n        this._xobjects[alias] = {\n          x: xobj,\n          o: xobjObjs\n        };\n      }\n\n      if (this._currentContent && !(alias in this._currentContent._xobjects)) {\n        for (var _i = 0; _i < this._xobjects[alias].o.length; ++_i) {\n          this._currentContent._xobjects[alias + '.' + _i] = this._xobjects[alias].o[_i].toReference();\n        }\n      }\n\n      var aliases = [];\n\n      for (var _i2 = 0; _i2 < this._xobjects[alias].o.length; ++_i2) {\n        aliases.push(alias + '.' + _i2);\n      }\n\n      return aliases;\n    }\n  }, {\n    key: \"_startPage\",\n    value: function () {\n      var _startPage2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var page, taken, alias, i, chunk, _i3, obj, _alias, _chunk, _i4, _obj, _alias2;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!this._currentPage) {\n                  _context.next = 2;\n                  break;\n                }\n\n                throw new Error('There is already a started page');\n\n              case 2:\n                page = this._currentPage = new PDF.Object('Page');\n\n                this._pages.push(page.toReference());\n\n                if (this._template) {\n                  taken = {};\n\n                  for (alias in this._template.colorSpaces) {\n                    taken[alias] = null;\n                  }\n\n                  i = 1;\n\n                  for (1; ('/CS' + i in taken); ++i) {}\n\n                  this._currentColorSpace = '/CS' + i;\n                } else {\n                  this._currentColorSpace = '/CS1';\n                }\n\n                _context.next = 7;\n                return this._startContentObject();\n\n              case 7:\n                if (!this._header) {\n                  _context.next = 14;\n                  break;\n                }\n\n                chunk = '';\n\n                for (_i3 in this._header._objects) {\n                  obj = this._header._objects[_i3];\n                  _alias = new PDF.Name(this._aliases.next('H'));\n                  this._currentContent._xobjects[_alias] = obj.toReference();\n                  chunk += ops.Do(_alias);\n                }\n\n                _context.next = 12;\n                return this._write(chunk);\n\n              case 12:\n                _context.next = 14;\n                return this._header._render();\n\n              case 14:\n                if (!this._footer) {\n                  _context.next = 21;\n                  break;\n                }\n\n                _chunk = '';\n\n                for (_i4 in this._footer._objects) {\n                  _obj = this._footer._objects[_i4];\n                  _alias2 = new PDF.Name(this._aliases.next('F'));\n                  this._currentContent._xobjects[_alias2] = _obj.toReference();\n                  _chunk += ops.Do(_alias2);\n                }\n\n                _context.next = 19;\n                return this._write(_chunk);\n\n              case 19:\n                _context.next = 21;\n                return this._footer._render();\n\n              case 21:\n                this._cursor.reset();\n\n                if (this._header) {\n                  this._cursor.y -= this._header.height;\n                }\n\n                if (this._footer) {\n                  this._cursor.bottomOffset = this._footer.height;\n                }\n\n              case 24:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function _startPage() {\n        return _startPage2.apply(this, arguments);\n      }\n\n      return _startPage;\n    }()\n  }, {\n    key: \"_endPage\",\n    value: function () {\n      var _endPage2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var fonts, xobjects, _iterator, _step, content, _alias7, _alias8, page, colorSpace, resources, contents, alias, _alias3, _alias4, extGStates, _alias5, shadings, _alias6;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (this._currentPage) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 2:\n                _context2.next = 4;\n                return this._endContentObject();\n\n              case 4:\n                fonts = new PDF.Dictionary({});\n                xobjects = new PDF.Dictionary({});\n                _iterator = _createForOfIteratorHelper(this._contents);\n\n                try {\n                  for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                    content = _step.value;\n\n                    for (_alias7 in content._fonts) {\n                      fonts.add(_alias7, content._fonts[_alias7]);\n                    }\n\n                    for (_alias8 in content._xobjects) {\n                      xobjects.add(_alias8, content._xobjects[_alias8]);\n                    }\n                  }\n                } catch (err) {\n                  _iterator.e(err);\n                } finally {\n                  _iterator.f();\n                }\n\n                page = this._currentPage;\n                page.prop('Parent', this._pagesObj.toReference());\n                colorSpace = new PDF.Dictionary({\n                  [this._currentColorSpace]: new PDF.Array([new PDF.Name('ICCBased'), this._colorSpace.toReference()])\n                });\n                resources = new PDF.Dictionary({\n                  ColorSpace: colorSpace,\n                  ProcSet: new PDF.Array([new PDF.Name('PDF'), new PDF.Name('Text'), new PDF.Name('ImageB'), new PDF.Name('ImageC'), new PDF.Name('ImageI')]),\n                  Font: fonts,\n                  XObject: xobjects\n                });\n                page.prop('Resources', resources);\n\n                if (this._annotations.length > 0) {\n                  page.prop('Annots', new PDF.Array(this._annotations));\n                  this._annotations = [];\n                }\n\n                contents = this._contents.map(function (c) {\n                  return c._object.toReference();\n                });\n                page.prop('Contents', new PDF.Array(contents));\n\n                if (this._template) {\n                  contents.unshift.apply(contents, this._template.contents);\n\n                  for (alias in this._template.colorSpaces) {\n                    colorSpace.dictionary[alias] = this._template.colorSpaces[alias];\n                  }\n\n                  for (_alias3 in this._template.fonts) {\n                    fonts.dictionary[_alias3] = this._template.fonts[_alias3];\n                  }\n\n                  for (_alias4 in this._template.xobjects) {\n                    xobjects.dictionary[_alias4] = this._template.xobjects[_alias4];\n                  }\n\n                  extGStates = new PDF.Dictionary({});\n\n                  for (_alias5 in this._template.extGStates) {\n                    extGStates.dictionary[_alias5] = this._template.extGStates[_alias5];\n                  }\n\n                  if (extGStates.length > 0) {\n                    resources.set('ExtGState', extGStates);\n                  }\n\n                  shadings = new PDF.Dictionary({});\n\n                  for (_alias6 in this._template.shadings) {\n                    shadings.dictionary[_alias6] = this._template.shadings[_alias6];\n                  }\n\n                  if (shadings.length > 0) {\n                    resources.set('Shading', shadings);\n                  }\n                }\n\n                _context2.next = 19;\n                return this._writeObject(page);\n\n              case 19:\n                this._currentContent = this._currentPage = null;\n                this._contents.length = 0;\n\n                if (this._template && this._template.firstPageOnly) {\n                  this._template = null;\n                }\n\n              case 22:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function _endPage() {\n        return _endPage2.apply(this, arguments);\n      }\n\n      return _endPage;\n    }()\n  }, {\n    key: \"_pageBreak\",\n    value: function () {\n      var _pageBreak2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (this._currentPage) {\n                  _context3.next = 3;\n                  break;\n                }\n\n                _context3.next = 3;\n                return this._startPage();\n\n              case 3:\n                _context3.next = 5;\n                return this._cursor.reset();\n\n              case 5:\n                _context3.next = 7;\n                return this._endPage();\n\n              case 7:\n                _context3.next = 9;\n                return this._startPage();\n\n              case 9:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function _pageBreak() {\n        return _pageBreak2.apply(this, arguments);\n      }\n\n      return _pageBreak;\n    }()\n  }, {\n    key: \"_startContentObject\",\n    value: function () {\n      var _startContentObject2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(obj, force) {\n        var content, chunk;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!(!force && this._length - 16 == this._contentStart)) {\n                  _context4.next = 2;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\", this._currentContent);\n\n              case 2:\n                if (!this._currentContent) {\n                  _context4.next = 5;\n                  break;\n                }\n\n                _context4.next = 5;\n                return this._endContentObject();\n\n              case 5:\n                if (this._contentObjCreator) {\n                  obj = this._contentObjCreator();\n                }\n\n                content = this._currentContent = new ContentChunk(this, obj);\n\n                this._contents.push(content);\n\n                this._xref.add(content._object.id, {\n                  offset: this._length,\n                  obj: content._object\n                });\n\n                chunk = content._object.id + ' ' + content._object.rev + ' obj\\n' + content._object.properties.toString() + '\\n' + 'stream\\n';\n                this._contentStart = this._length + chunk.length; // set color space\n\n                chunk += ops.CS(this._currentColorSpace) + ops.cs(this._currentColorSpace);\n                _context4.next = 14;\n                return this._write(chunk);\n\n              case 14:\n                return _context4.abrupt(\"return\", content);\n\n              case 15:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function _startContentObject(_x, _x2) {\n        return _startContentObject2.apply(this, arguments);\n      }\n\n      return _startContentObject;\n    }()\n  }, {\n    key: \"_endContentObject\",\n    value: function () {\n      var _endContentObject2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var chunk;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                if (this._currentContent) {\n                  _context5.next = 2;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\");\n\n              case 2:\n                this._currentContent._length.content = this._length - this._contentStart - 1;\n\n                if (this._currentContent._length.content < 0) {\n                  this._currentContent._length.content = 0;\n                }\n\n                chunk = 'endstream\\nendobj\\n\\n';\n                _context5.next = 7;\n                return this._write(chunk);\n\n              case 7:\n                _context5.next = 9;\n                return this._writeObject(this._currentContent._length);\n\n              case 9:\n                this._currentContent = null;\n\n              case 10:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function _endContentObject() {\n        return _endContentObject2.apply(this, arguments);\n      }\n\n      return _endContentObject;\n    }()\n  }, {\n    key: \"_registerObject\",\n    value: function _registerObject(object, force) {\n      if (object instanceof PDF.Stream) {\n        object = object.object;\n      }\n\n      if (!force && object.id) {\n        return;\n      }\n\n      object.id = this._nextObjectId;\n      this._nextObjectId++;\n    }\n  }, {\n    key: \"_writeObject\",\n    value: function _writeObject(object) {\n      if (object instanceof PDF.Stream) {\n        object = object.object;\n      }\n\n      if (!object.id) {\n        this._registerObject(object);\n      }\n\n      this._xref.add(object.id, {\n        offset: this._length,\n        obj: object\n      });\n\n      return this._write(object.toString() + '\\n\\n');\n    }\n  }, {\n    key: \"_updateOutlinesCount\",\n    value: function _updateOutlinesCount(id) {\n      if (this._outlines[id].data.count < 1) {\n        this._outlines[id].data.count -= 1;\n\n        this._outlines[id].prop('Count', this._outlines[id].data.count);\n      } else {\n        this._outlines[id].data.count = -1;\n\n        this._outlines[id].prop('Count', this._outlines[id].data.count);\n      }\n\n      var nextParent = this._outlines[id].data.parentIndex;\n\n      if (nextParent !== undefined) {\n        this._updateOutlinesCount(nextParent);\n      }\n    } // public API\n\n  }, {\n    key: \"end\",\n    value: function () {\n      var _end = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n        var _iterator2, _step2, fn, alias, font, _alias9, xobj, catalog, destsObj, i, startxref, objectsCount, trailer;\n\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.next = 2;\n                return Fragment.prototype.end.call(this);\n\n              case 2:\n                _context6.next = 4;\n                return this._next();\n\n              case 4:\n                _context6.next = 6;\n                return this._endPage();\n\n              case 6:\n                _iterator2 = _createForOfIteratorHelper(this._finalize);\n                _context6.prev = 7;\n\n                _iterator2.s();\n\n              case 9:\n                if ((_step2 = _iterator2.n()).done) {\n                  _context6.next = 15;\n                  break;\n                }\n\n                fn = _step2.value;\n                _context6.next = 13;\n                return fn();\n\n              case 13:\n                _context6.next = 9;\n                break;\n\n              case 15:\n                _context6.next = 20;\n                break;\n\n              case 17:\n                _context6.prev = 17;\n                _context6.t0 = _context6[\"catch\"](7);\n\n                _iterator2.e(_context6.t0);\n\n              case 20:\n                _context6.prev = 20;\n\n                _iterator2.f();\n\n                return _context6.finish(20);\n\n              case 23:\n                this._pagesObj.prop('MediaBox', new PDF.Array([0, 0, this.width, this.height]));\n\n                this._pagesObj.prop('Kids', this._pages);\n\n                this._pagesObj.prop('Count', this._pages.length);\n\n                _context6.next = 28;\n                return this._writeObject(this._pagesObj);\n\n              case 28:\n                _context6.next = 30;\n                return this._writeObject(this._colorSpace);\n\n              case 30:\n                _context6.t1 = _regeneratorRuntime.keys(this._fonts);\n\n              case 31:\n                if ((_context6.t2 = _context6.t1()).done) {\n                  _context6.next = 38;\n                  break;\n                }\n\n                alias = _context6.t2.value;\n                font = this._fonts[alias];\n                _context6.next = 36;\n                return font.f.write(this, font.o);\n\n              case 36:\n                _context6.next = 31;\n                break;\n\n              case 38:\n                _context6.t3 = _regeneratorRuntime.keys(this._xobjects);\n\n              case 39:\n                if ((_context6.t4 = _context6.t3()).done) {\n                  _context6.next = 46;\n                  break;\n                }\n\n                _alias9 = _context6.t4.value;\n                xobj = this._xobjects[_alias9];\n                _context6.next = 44;\n                return xobj.x.write(this, xobj.o);\n\n              case 44:\n                _context6.next = 39;\n                break;\n\n              case 46:\n                catalog = new PDF.Object('Catalog');\n                catalog.prop('Pages', this._pagesObj.toReference());\n\n                if (!(this._destinations.length > 0)) {\n                  _context6.next = 54;\n                  break;\n                }\n\n                destsObj = new PDF.Object();\n                destsObj.prop(\"Dests\", this._destinations);\n                _context6.next = 53;\n                return this._writeObject(destsObj);\n\n              case 53:\n                catalog.prop('Names', destsObj.toReference());\n\n              case 54:\n                if (!(this._outlines.length > 0)) {\n                  _context6.next = 63;\n                  break;\n                }\n\n                i = 0;\n\n              case 56:\n                if (!(i < this._outlines.length)) {\n                  _context6.next = 62;\n                  break;\n                }\n\n                _context6.next = 59;\n                return this._writeObject(this._outlines[i]);\n\n              case 59:\n                i += 1;\n                _context6.next = 56;\n                break;\n\n              case 62:\n                catalog.prop('Outlines', this._outlines[0].toReference());\n\n              case 63:\n                _context6.next = 65;\n                return this._writeObject(catalog);\n\n              case 65:\n                // to support random access to individual objects, a PDF file\n                // contains a cross-reference table that can be used to locate\n                // and directly access pages and other important objects within the file\n                startxref = this._length;\n                _context6.next = 68;\n                return this._write(this._xref.toString());\n\n              case 68:\n                // trailer\n                objectsCount = this._nextObjectId - 1;\n                trailer = new PDF.Trailer(objectsCount + 1, catalog, this.info);\n                _context6.next = 72;\n                return this._write(trailer.toString() + '\\n');\n\n              case 72:\n                _context6.next = 74;\n                return this._write('startxref\\n' + startxref + '\\n%%EOF');\n\n              case 74:\n                // close readable stream\n                this.push(null);\n\n              case 75:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[7, 17, 20, 23]]);\n      }));\n\n      function end() {\n        return _end.apply(this, arguments);\n      }\n\n      return end;\n    }()\n  }, {\n    key: \"asBuffer\",\n    value: function asBuffer(opts, callback) {\n      var _this4 = this;\n\n      if (typeof opts === 'function') {\n        callback = opts;\n        opts = undefined;\n      }\n\n      var shouldEnd = !opts || opts.end !== false;\n      var p = new Promise(function (resolve, reject) {\n        var chunks = [];\n\n        _this4.on('data', function (chunk) {\n          return chunks.push(chunk);\n        });\n\n        _this4.on('end', function () {\n          return resolve(Buffer.concat(chunks));\n        });\n\n        _this4.on('error', reject);\n\n        if (shouldEnd) {\n          _this4.end();\n        }\n      });\n\n      if (typeof callback === 'function') {\n        p = p.then(function (data) {\n          return callback(null, data);\n        }).catch(callback);\n      }\n\n      return p;\n    }\n  }, {\n    key: \"header\",\n    value: function header() {\n      var _this5 = this;\n\n      var Header = require('./header');\n\n      var ctx = new Header(this, this);\n\n      this._begin(ctx);\n\n      this._pending.push(function () {\n        _this5._header = ctx;\n        return ctx._start();\n      });\n\n      return ctx;\n    }\n  }, {\n    key: \"footer\",\n    value: function footer() {\n      var _this6 = this;\n\n      var Footer = require('./footer');\n\n      var ctx = new Footer(this, this);\n\n      this._begin(ctx);\n\n      this._pending.push(function () {\n        _this6._footer = ctx;\n        return ctx._start();\n      });\n\n      return ctx;\n    }\n  }, {\n    key: \"addPagesOf\",\n    value: function addPagesOf(external) {\n      var _this7 = this;\n\n      if (!(external instanceof ExternalDocument)) {\n        throw new TypeError('argument must be of type ExternalDocument');\n      }\n\n      this._begin(null);\n\n      this._pending.push(function () {\n        return external.write(_this7);\n      });\n    }\n  }, {\n    key: \"addPageOf\",\n    value: function addPageOf(page, external) {\n      var _this8 = this;\n\n      if (!(external instanceof ExternalDocument)) {\n        throw new TypeError('argument must be of type ExternalDocument');\n      }\n\n      if (!page || page < 1 || page > external.pageCount) {\n        throw new TypeError('ExternalDocument does not have page ' + page);\n      }\n\n      this._begin(null);\n\n      this._pending.push(function () {\n        return external.write(_this8, page);\n      });\n    }\n  }, {\n    key: \"setTemplate\",\n    value: function setTemplate(external) {\n      var _this9 = this;\n\n      var firstPageOnly = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n      if (!(external instanceof ExternalDocument)) {\n        throw new TypeError('argument must be of type ExternalDocument');\n      }\n\n      this._begin(null);\n\n      this._pending.push(function () {\n        return external.setAsTemplate(_this9, firstPageOnly);\n      });\n    }\n  }, {\n    key: \"outline\",\n    value: function outline(title, destination, parent) {\n      // Skip empty titles and/or destination\n      if (title === undefined || destination === undefined) return; // Create the root outline the first time this method is called\n\n      if (this._outlines.length === 0) {\n        this._outlines[0] = new PDF.Object('Outlines');\n        this._outlines[0].data = {\n          type: 'Outlines'\n        };\n\n        this._registerObject(this._outlines[0]);\n      } // Find parent item\n\n\n      var parentIndex;\n\n      if (typeof parent === 'number' && parent >= 0 && parent <= this._outlines.length) {\n        // the user provided a valid index number: use it as the parentIndex\n        parentIndex = parent;\n      } else {\n        // the user did not provide a valid index number: search for it in the outline array\n        // if it is not found, create the corresponding parent at root level\n        if (parent === undefined || parent === '') {\n          parentIndex = 0;\n        } else {\n          parentIndex = this._outlines.findIndex(function (item, index) {\n            return item.data.title === parent;\n          });\n          if (parentIndex === -1) parentIndex = this.outline(parent, destination);\n        }\n      } // Find siblings\n\n\n      var siblingsIndexes = this._outlines.reduce(function (result, item, index) {\n        if (index !== 0 && item.data.parentIndex === parentIndex) result.push(index);\n        return result;\n      }, []); // Create item\n\n\n      var outline = new PDF.Object();\n      outline.data = {\n        title: title,\n        destination: destination,\n        parent: parent\n      };\n      outline.prop('Title', new PDF.String(title));\n      outline.prop('Parent', this._outlines[parentIndex].toReference());\n      outline.prop('A', new PDF.Dictionary({\n        S: 'GoTo',\n        D: new PDF.String(destination)\n      }));\n\n      this._registerObject(outline);\n\n      var outlineIndex = this._outlines.push(outline) - 1; // Chain to siblings\n\n      var prevSiblingIndex = siblingsIndexes[siblingsIndexes.length - 1];\n\n      if (prevSiblingIndex > 0) {\n        // Next\n        this._outlines[prevSiblingIndex].data.nextId = outlineIndex;\n\n        this._outlines[prevSiblingIndex].prop('Next', this._outlines[outlineIndex].toReference()); // Prev\n\n\n        this._outlines[outlineIndex].data.prevId = prevSiblingIndex;\n\n        this._outlines[outlineIndex].prop('Prev', this._outlines[prevSiblingIndex].toReference());\n      } // Chain to parents\n\n\n      this._outlines[outlineIndex].data.parentIndex = parentIndex;\n\n      if (siblingsIndexes.length === 0) {\n        // First\n        this._outlines[parentIndex].data.firstIndex = outlineIndex;\n\n        this._outlines[parentIndex].prop('First', this._outlines[outlineIndex].toReference());\n      } // Last\n\n\n      this._outlines[parentIndex].data.lastIndex = outlineIndex;\n\n      this._outlines[parentIndex].prop('Last', this._outlines[outlineIndex].toReference()); // Count(s)\n\n\n      this._updateOutlinesCount(parentIndex);\n\n      return outlineIndex;\n    }\n  }]);\n\n  return Document;\n}(Readable);\n\nObject.assign(Document.prototype, {\n  _begin: Fragment.prototype._begin,\n  _end: Fragment.prototype._end,\n  _opts: Fragment.prototype._opts,\n  text: Fragment.prototype.text,\n  cell: Fragment.prototype.cell,\n  table: Fragment.prototype.table,\n  image: Fragment.prototype.image,\n  pageBreak: Fragment.prototype.pageBreak,\n  op: Fragment.prototype.op,\n  destination: Fragment.prototype.destination\n});\n\nvar AliasGenerator = /*#__PURE__*/function () {\n  function AliasGenerator() {\n    _classCallCheck(this, AliasGenerator);\n\n    this.nextId = {};\n    this.blocked = new Set();\n  }\n\n  _createClass(AliasGenerator, [{\n    key: \"next\",\n    value: function next(prefix) {\n      if (!(prefix in this.nextId)) {\n        this.nextId[prefix] = 1;\n      }\n\n      var next;\n\n      do {\n        next = prefix + this.nextId[prefix]++;\n      } while (this.blocked.has(next));\n\n      return next;\n    }\n  }, {\n    key: \"block\",\n    value: function block(alias) {\n      alias = String(alias);\n\n      if (alias[0] === '/') {\n        alias = alias.slice(1);\n      }\n\n      this.blocked.add(alias);\n    }\n  }, {\n    key: \"isBlocked\",\n    value: function isBlocked(alias) {\n      alias = String(alias);\n\n      if (alias[0] === '/') {\n        alias = alias.slice(1);\n      }\n\n      return this.blocked.has(alias);\n    }\n  }, {\n    key: \"reset\",\n    value: function reset(prefix) {\n      this.nextId[prefix] = 1;\n    }\n  }]);\n\n  return AliasGenerator;\n}();\n\nmodule.exports = Document;","map":{"version":3,"sources":["/Users/mikebannoura/Dropbox/My Mac (MacBook-Pro-Mike.local)/Desktop/mmbball-app/client/node_modules/pdfjs/lib/document.js"],"names":["Cursor","require","Fragment","ops","PDF","Readable","uuidv4","v4","util","ContentChunk","ExternalDocument","Font","RESOLVE","Promise","resolve","Document","opts","highWaterMark","version","info","Object","assign","properties","id","width","height","_nextObjectId","_xref","Xref","_reading","_length","header","_pending","_write","current","defaultFont","font","defaultFontSize","fontSize","defaultColor","color","colorToRgb","defaultLineHeight","lineHeight","isFont","TypeError","_fonts","_xobjects","_pageFonts","_annotations","_aliases","AliasGenerator","_mapping","WeakMap","_currentContent","_contents","_contentObjCreator","_finalize","_header","_footer","_template","padding","paddingTop","defaults","paddingBottom","paddingLeft","paddingRight","_cursor","_pages","Array","_pagesObj","_registerObject","_destinations","NameTree","_outlines","_colorSpace","iccProfile","content","prop","length","Name","_currentColorSpace","_next","prototype","_init","call","parent","next","isArray","shift","then","emit","chunk","push","once","alias","has","get","isBlocked","delete","undefined","set","fontObj","f","instance","o","toReference","_useFont","xobj","xobjObjs","i","xobjCount","xobjObj","x","aliases","_currentPage","Error","page","taken","colorSpaces","_startContentObject","_objects","obj","Do","_render","reset","y","bottomOffset","_endContentObject","fonts","Dictionary","xobjects","add","colorSpace","resources","ColorSpace","ProcSet","XObject","contents","map","c","_object","unshift","apply","dictionary","extGStates","shadings","_writeObject","firstPageOnly","_startPage","_endPage","force","_contentStart","offset","rev","toString","CS","cs","object","Stream","data","count","nextParent","parentIndex","_updateOutlinesCount","end","fn","write","catalog","destsObj","startxref","objectsCount","trailer","Trailer","callback","shouldEnd","p","reject","chunks","on","Buffer","concat","catch","Header","ctx","_begin","_start","Footer","external","pageCount","setAsTemplate","title","destination","type","findIndex","item","index","outline","siblingsIndexes","reduce","result","String","S","D","outlineIndex","prevSiblingIndex","nextId","prevId","firstIndex","lastIndex","_end","_opts","text","cell","table","image","pageBreak","op","blocked","Set","prefix","slice","module","exports"],"mappings":"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","sourcesContent":["'use strict'\n\nconst Cursor = require('./cursor')\nconst Fragment = require('./fragment')\nconst ops = require('./ops')\nconst PDF = require('./object')\nconst Readable = require('readable-stream')\nconst { v4: uuidv4 } = require('uuid')\nconst util = require('./util')\nconst ContentChunk = require('./content')\nconst ExternalDocument = require('./external')\nconst Font = require('./font/base')\n\n// constants\nconst RESOLVE = Promise.resolve()\n\nclass Document extends Readable {\n  constructor(opts) {\n    if (!opts) {\n      opts = {}\n    }\n\n    // readable stream options\n    super({\n      highWaterMark: opts.highWaterMark || 16384, // 16kB\n    })\n\n    this.version = '1.6'\n    this.info = Object.assign({}, opts.properties, { id: uuidv4() })\n    this.width = opts.width || 595.296\n    this.height = opts.height || 841.896\n\n    this._nextObjectId = 1\n    this._xref = new PDF.Xref()\n    this._reading = false // wheater someone is reading data from the underlying Readable\n    this._length = 0 // keeps track of the total document length (in byte)\n\n    // header\n    const header = `%PDF-${this.version}\\n`\n      // The PDF format mandates that we add at least 4 commented binary characters\n      // (ASCII value >= 128), so that generic tools have a chance to detect\n      // that it's a binary file\n      + '%\\xFF\\xFF\\xFF\\xFF\\n\\n'\n\n    // a backlog of pending operations\n    this._pending = [\n      () => this._write(header)\n    ]\n    // this is the current operation that is executed (operations are executed sequentially)\n    this._pending.current = null\n\n    // init default styling opts\n    this.defaultFont = opts.font || require('../font/Helvetica')\n    this.defaultFontSize = opts.fontSize || 11\n    this.defaultColor = opts.color && util.colorToRgb(opts.color) || [0, 0, 0]\n    this.defaultLineHeight = opts.lineHeight || 1.15\n\n    if (!Font.isFont(this.defaultFont)) {\n      throw new TypeError('opts.font must be set to a valid default font')\n    }\n\n    // create document and page font dict\n    this._fonts = {}\n    this._xobjects = {}\n    this._pageFonts = {}\n    this._annotations = []\n\n    // these properties are used to keep track of used Font and Image objects and assign ids to\n    // them in a document-scoped way\n    this._aliases = new AliasGenerator()\n    this._mapping = new WeakMap()\n\n    // a page could consist out of multiple content chunks, which are keept track of using the\n    // following properties\n    this._currentContent = null\n    this._contents = []\n    this._contentObjCreator = null\n\n    // this array can be used to register callbacks that are executed when finalizing the document\n    // e.g. rendering the total page count\n    this._finalize = []\n\n    this._header = this._footer = this._template = null\n\n    // init cursor\n    // TODO: test for valid values\n    const padding = opts.padding >= 0 ? opts.padding : 20\n    this.paddingTop = util.defaults(opts.paddingTop, padding)\n    this.paddingBottom = util.defaults(opts.paddingBottom, padding)\n    this.paddingLeft = util.defaults(opts.paddingLeft, padding)\n    this.paddingRight = util.defaults(opts.paddingRight, padding)\n\n    this._cursor = new Cursor(\n      this.width - this.paddingLeft - this.paddingRight, this.height - this.paddingTop - this.paddingBottom, // width, height\n      this.paddingLeft, this.height - this.paddingTop // x, y\n    )\n\n    // init pages catalog\n    this._pages = new PDF.Array()\n    this._pagesObj = new PDF.Object('Pages')\n    this._registerObject(this._pagesObj)\n\n    // init destinations name tree\n    this._destinations = new PDF.NameTree()\n\n    // init outlines hierarchy\n    this._outlines = []\n\n    // init color space\n    this._colorSpace = new PDF.Object()\n    const iccProfile = require('./sRGB_IEC61966-2-1_black_scaled') + '~>'\n    this._colorSpace.content = 'stream\\n' + iccProfile + '\\nendstream\\n'\n    this._colorSpace.prop('Length', iccProfile.length)\n    this._colorSpace.prop('N', 3)\n    this._colorSpace.prop('Alternate', 'DeviceRGB')\n    // this._colorSpace.prop('Filter', new PDF.Array([\n    //   new PDF.Name('ASCII85Decode'), new PDF.Name('FlateDecode')\n    // ]))\n    this._colorSpace.prop('Filter', new PDF.Name('ASCII85Decode'))\n    this._registerObject(this._colorSpace)\n    this._currentColorSpace = '/CS1'\n\n    // start to work the _pending queue\n    this._next()\n\n    Fragment.prototype._init.call(this, this, this);\n  }\n\n  /// private API\n\n  _next() {\n    // return if there is already an operation worked on\n    if (this._pending.current) {\n      return this._pending.current\n    }\n\n    // variables used to traverse the nested queue\n    let parent = this._pending\n    let next = parent[0]\n\n    // if there is nothing in the queue, we are done here\n    if (!next) {\n      return RESOLVE\n    }\n\n    // the operation queue is a nested array, e.g.: [op1, [op2, op3, [ op4 ]], op5]\n    // it is therefore necessary traverse the first element until the first non array element\n    // is encountered\n    while (Array.isArray(next)) {\n      // if the first element is an empty array, remove it and start over\n      if (next.length === 0) {\n        parent.shift()\n        return this._next()\n      }\n\n      parent = next\n      next = next[0]\n    }\n\n    // remove next from the queue\n    parent.shift()\n\n    // TODO: still necessary?\n    // if (!next) {\n    //   return this._next()\n    // }\n\n    // return and set the current operation that is being executed\n    return this._pending.current = next().then(() => {\n      // once the execution finished, continue in the queue\n      this._pending.current = null\n      return this._next()\n    })\n  }\n\n  // This is method is used by Node.js stream.Readable class, which we inherit from.\n  // The method is called, if data is available from the resource, which means that we should\n  // start pushing data into the read queue (using `this.push(dataChunk)`). It should continue\n  // reading from the resoruce and pushing data until `this.push()` return `false`. Only when it\n  // is called again aft it has stopped should it resume pushing additional data onto the\n  // read queue.\n  _read(/* size */) {\n    this._reading = true\n    this.emit('read')\n  }\n\n  // This method is used to push data onto the read queue. If the Readable stream is currently\n  // not read from, the writing is postponed.\n  _write(chunk) {\n    if (this._reading) {\n      if (!this.push(chunk, 'binary')) {\n        this._reading = false\n      }\n      this._length += chunk.length\n      return RESOLVE\n    } else {\n      return new Promise(resolve => {\n        this.once('read', () => {\n          resolve(this._write(chunk))\n        })\n      })\n    }\n  }\n\n  _useFont(font) {\n    let alias\n    if (this._mapping.has(font)) {\n      alias = this._mapping.get(font)\n      // if the alias exists but is now blocked (e.g. because of having set a new template with\n      // colliding aliases), remove the mapping and unset the alias to force creation of a new one\n      if (this._aliases.isBlocked(alias)) {\n        this._mapping.delete(font)\n        alias = undefined\n      }\n    }\n\n    if (!alias) {\n      alias = new PDF.Name(this._aliases.next('F'))\n      this._mapping.set(font, alias)\n\n      const fontObj = new PDF.Object('Font')\n      this._fonts[alias] = { f: font.instance(), o: fontObj }\n      this._registerObject(fontObj)\n    }\n\n    if (this._currentContent && !(alias in this._currentContent._fonts)) {\n      this._currentContent._fonts[alias] = this._fonts[alias].o.toReference()\n    }\n\n    return alias\n  }\n\n  _fontAlias(instance) {\n    return this._useFont(instance.parent)\n  }\n\n  _fontInstance(font) {\n    return this._fonts[this._useFont(font)].f\n  }\n\n  _useXObject(xobj) {\n    let alias\n    if (this._mapping.has(xobj)) {\n      alias = this._mapping.get(xobj)\n      // if the alias exists but is now blocked (e.g. because of having set a new template with\n      // colliding aliases), remove the mapping and unset the alias to force creation of a new one\n      if (this._aliases.isBlocked(alias)) {\n        this._mapping.delete(xobj)\n        alias = undefined\n      }\n    }\n\n    if (!alias) {\n      alias = new PDF.Name(this._aliases.next('X'))\n      this._mapping.set(xobj, alias)\n\n      const xobjObjs = []\n      for (let i = 0; i < xobj.xobjCount; ++i) {\n        const xobjObj = new PDF.Object('XObject')\n        this._registerObject(xobjObj)\n        xobjObjs.push(xobjObj)\n      }\n      this._xobjects[alias] = { x: xobj, o: xobjObjs }\n    }\n\n    if (this._currentContent && !(alias in this._currentContent._xobjects)) {\n      for (let i = 0; i < this._xobjects[alias].o.length; ++i) {\n        this._currentContent._xobjects[alias + '.' + i] = this._xobjects[alias].o[i].toReference()\n      }\n    }\n\n    const aliases = []\n    for (let i = 0; i < this._xobjects[alias].o.length; ++i) {\n      aliases.push(alias + '.' + i)\n    }\n    return aliases\n  }\n\n  async _startPage() {\n    if (this._currentPage) {\n      throw new Error('There is already a started page')\n    }\n\n    const page = this._currentPage = new PDF.Object('Page')\n    this._pages.push(page.toReference())\n\n    if (this._template) {\n      const taken = {}\n      for (const alias in this._template.colorSpaces) {\n        taken[alias] = null\n      }\n\n      let i = 1\n      for (1; ('/CS' + i) in taken; ++i) {}\n      this._currentColorSpace = '/CS' + i\n    } else {\n      this._currentColorSpace = '/CS1'\n    }\n\n    await this._startContentObject()\n\n    if (this._header) {\n      let chunk = ''\n      for (const i in this._header._objects) {\n        const obj = this._header._objects[i]\n        const alias = new PDF.Name(this._aliases.next('H'))\n        this._currentContent._xobjects[alias] = obj.toReference()\n        chunk += ops.Do(alias)\n      }\n\n      await this._write(chunk)\n      await this._header._render()\n    }\n\n    if (this._footer) {\n      let chunk = ''\n      for (const i in this._footer._objects) {\n        const obj = this._footer._objects[i]\n        const alias = new PDF.Name(this._aliases.next('F'))\n        this._currentContent._xobjects[alias] = obj.toReference()\n        chunk += ops.Do(alias)\n      }\n\n      await this._write(chunk)\n      await this._footer._render()\n    }\n\n    this._cursor.reset()\n\n    if (this._header) {\n      this._cursor.y -= this._header.height\n    }\n\n    if (this._footer) {\n      this._cursor.bottomOffset = this._footer.height\n    }\n  }\n\n  async _endPage() {\n    if (!this._currentPage) {\n      return\n    }\n\n    await this._endContentObject()\n\n    const fonts = new PDF.Dictionary({})\n    const xobjects = new PDF.Dictionary({})\n\n    for (const content of this._contents) {\n      for (const alias in content._fonts) {\n        fonts.add(alias, content._fonts[alias])\n      }\n\n      for (const alias in content._xobjects) {\n        xobjects.add(alias, content._xobjects[alias])\n      }\n    }\n\n    const page = this._currentPage\n    page.prop('Parent', this._pagesObj.toReference())\n\n    const colorSpace = new PDF.Dictionary({\n      [this._currentColorSpace]: new PDF.Array([new PDF.Name('ICCBased'), this._colorSpace.toReference()])\n    })\n    const resources = new PDF.Dictionary({\n      ColorSpace: colorSpace,\n      ProcSet: new PDF.Array([\n        new PDF.Name('PDF'),\n        new PDF.Name('Text'),\n        new PDF.Name('ImageB'),\n        new PDF.Name('ImageC'),\n        new PDF.Name('ImageI')\n      ]),\n      Font:    fonts,\n      XObject: xobjects,\n    })\n    page.prop('Resources', resources)\n\n    if (this._annotations.length > 0) {\n      page.prop('Annots', new PDF.Array(this._annotations))\n      this._annotations = []\n    }\n\n    const contents = this._contents.map(c => c._object.toReference())\n    page.prop('Contents', new PDF.Array(contents))\n\n    if (this._template) {\n      contents.unshift.apply(contents, this._template.contents)\n\n      for (const alias in this._template.colorSpaces) {\n        colorSpace.dictionary[alias] = this._template.colorSpaces[alias]\n      }\n\n      for (const alias in this._template.fonts) {\n        fonts.dictionary[alias] = this._template.fonts[alias]\n      }\n\n      for (const alias in this._template.xobjects) {\n        xobjects.dictionary[alias] = this._template.xobjects[alias]\n      }\n\n      const extGStates = new PDF.Dictionary({})\n      for (const alias in this._template.extGStates) {\n        extGStates.dictionary[alias] = this._template.extGStates[alias]\n      }\n      if (extGStates.length > 0) {\n        resources.set('ExtGState', extGStates)\n      }\n\n      const shadings = new PDF.Dictionary({})\n      for (const alias in this._template.shadings) {\n        shadings.dictionary[alias] = this._template.shadings[alias]\n      }\n      if (shadings.length > 0) {\n        resources.set('Shading', shadings)\n      }\n    }\n\n    await this._writeObject(page)\n\n    this._currentContent = this._currentPage = null\n    this._contents.length = 0\n\n    if (this._template && this._template.firstPageOnly) {\n      this._template = null\n    }\n  }\n\n  async _pageBreak(/* level */) {\n    if (!this._currentPage) {\n      await this._startPage()\n    }\n\n    await this._cursor.reset()\n\n    await this._endPage()\n    await this._startPage()\n  }\n\n  async _startContentObject(obj, force) {\n    // do not create new content object, if current content object is still empty\n    // 16 = /CS1 CS\n    //      /CS1 cs\n    if (!force && this._length - 16 == this._contentStart) {\n      return this._currentContent\n    }\n\n    if (this._currentContent) {\n      await this._endContentObject()\n    }\n\n    if (this._contentObjCreator) {\n      obj = this._contentObjCreator()\n    }\n\n    const content = this._currentContent = new ContentChunk(this, obj)\n    this._contents.push(content)\n\n    this._xref.add(content._object.id, {\n      offset: this._length,\n      obj:    content._object,\n    })\n\n    let chunk = content._object.id + ' ' + content._object.rev + ' obj\\n'\n      + content._object.properties.toString() + '\\n'\n      + 'stream\\n'\n\n    this._contentStart = this._length + chunk.length\n\n    // set color space\n    chunk += ops.CS(this._currentColorSpace) + ops.cs(this._currentColorSpace)\n    await this._write(chunk)\n\n    return content\n  }\n\n  async _endContentObject() {\n    if (!this._currentContent) {\n      return\n    }\n\n    this._currentContent._length.content = this._length - this._contentStart - 1\n    if (this._currentContent._length.content < 0) {\n      this._currentContent._length.content = 0\n    }\n\n    const chunk = 'endstream\\nendobj\\n\\n'\n    await this._write(chunk)\n    await this._writeObject(this._currentContent._length)\n\n    this._currentContent = null\n  }\n\n  _registerObject(object, force) {\n    if (object instanceof PDF.Stream) {\n      object = object.object\n    }\n\n    if (!force && object.id) {\n      return\n    }\n\n    object.id = this._nextObjectId\n    this._nextObjectId++\n  }\n\n  _writeObject(object) {\n    if (object instanceof PDF.Stream) {\n      object = object.object\n    }\n\n    if (!object.id) {\n      this._registerObject(object)\n    }\n\n    this._xref.add(object.id, {\n      offset: this._length,\n      obj:    object,\n    })\n    return this._write(object.toString() + '\\n\\n')\n  }\n\n  _updateOutlinesCount(id) {\n    if (this._outlines[id].data.count < 1) {\n      this._outlines[id].data.count -= 1\n      this._outlines[id].prop('Count', this._outlines[id].data.count)\n    } else {\n      this._outlines[id].data.count = -1\n      this._outlines[id].prop('Count', this._outlines[id].data.count)\n    }\n    const nextParent = this._outlines[id].data.parentIndex\n    if(nextParent !== undefined) {\n      this._updateOutlinesCount(nextParent)\n    }\n  }\n\n  // public API\n\n  async end() {\n\n    await Fragment.prototype.end.call(this);\n\n    await this._next()\n    await this._endPage()\n\n    for (const fn of this._finalize) {\n      await fn()\n    }\n\n    this._pagesObj.prop('MediaBox', new PDF.Array([0, 0, this.width, this.height]))\n    this._pagesObj.prop('Kids', this._pages)\n    this._pagesObj.prop('Count', this._pages.length)\n    await this._writeObject(this._pagesObj)\n    await this._writeObject(this._colorSpace)\n\n    for (const alias in this._fonts) {\n      const font = this._fonts[alias]\n      await font.f.write(this, font.o)\n    }\n\n    for (const alias in this._xobjects) {\n      const xobj = this._xobjects[alias]\n      await xobj.x.write(this, xobj.o)\n    }\n\n    const catalog = new PDF.Object('Catalog')\n    catalog.prop('Pages', this._pagesObj.toReference())\n    if (this._destinations.length > 0) {\n      const destsObj = new PDF.Object()\n      destsObj.prop(\"Dests\", this._destinations)\n      await this._writeObject(destsObj)\n      catalog.prop('Names', destsObj.toReference())\n    }\n    //Write outlines hierarchy if there are outlines\n    if(this._outlines.length > 0) {\n      for (let i = 0; i < this._outlines.length; i += 1) {\n        await this._writeObject(this._outlines[i])\n      }\n      catalog.prop('Outlines', this._outlines[0].toReference())\n    }\n    await this._writeObject(catalog)\n\n    // to support random access to individual objects, a PDF file\n    // contains a cross-reference table that can be used to locate\n    // and directly access pages and other important objects within the file\n    const startxref = this._length\n    await this._write(this._xref.toString())\n\n    // trailer\n    const objectsCount = this._nextObjectId - 1\n    const trailer = new PDF.Trailer(objectsCount + 1, catalog, this.info)\n    await this._write(trailer.toString() + '\\n')\n\n    // startxref\n    await this._write('startxref\\n' + startxref + '\\n%%EOF')\n\n    // close readable stream\n    this.push(null)\n  }\n\n  asBuffer(opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts\n      opts = undefined\n    }\n\n    const shouldEnd = !opts || opts.end !== false\n    let p = new Promise((resolve, reject) => {\n      const chunks = []\n      this.on('data', chunk => chunks.push(chunk))\n      this.on('end', () => resolve(Buffer.concat(chunks)))\n      this.on('error', reject)\n      if (shouldEnd) {\n        this.end()\n      }\n    })\n    if (typeof callback === 'function') {\n      p = p.then(data => callback(null, data)).catch(callback)\n    }\n    return p\n  }\n\n\n  header() {\n    const Header = require('./header')\n    const ctx = new Header(this, this)\n    this._begin(ctx)\n\n    this._pending.push(() => {\n      this._header = ctx\n      return ctx._start()\n    })\n\n    return ctx\n  }\n\n  footer() {\n    const Footer = require('./footer')\n    const ctx = new Footer(this, this)\n    this._begin(ctx)\n\n    this._pending.push(() => {\n      this._footer = ctx\n      return ctx._start()\n    })\n\n    return ctx\n  }\n\n  addPagesOf(external) {\n    if (!(external instanceof ExternalDocument)) {\n      throw new TypeError('argument must be of type ExternalDocument')\n    }\n\n    this._begin(null)\n    this._pending.push(() => external.write(this))\n  }\n\n  addPageOf(page, external) {\n    if (!(external instanceof ExternalDocument)) {\n      throw new TypeError('argument must be of type ExternalDocument')\n    }\n\n    if (!page || page < 1 || page > external.pageCount) {\n      throw new TypeError('ExternalDocument does not have page ' + page)\n    }\n\n    this._begin(null)\n    this._pending.push(() => external.write(this, page))\n  }\n\n  setTemplate(external, firstPageOnly = false) {\n    if (!(external instanceof ExternalDocument)) {\n      throw new TypeError('argument must be of type ExternalDocument')\n    }\n\n    this._begin(null)\n    this._pending.push(() => external.setAsTemplate(this, firstPageOnly))\n  }\n\n  outline(title, destination, parent) {\n    // Skip empty titles and/or destination\n    if (title === undefined || destination === undefined) return\n\n    // Create the root outline the first time this method is called\n    if (this._outlines.length === 0 ){\n      this._outlines[0] = new PDF.Object('Outlines')\n      this._outlines[0].data = {type: 'Outlines'}\n      this._registerObject(this._outlines[0])\n    }\n    // Find parent item\n    let parentIndex\n    if (typeof parent === 'number' && parent >= 0 && parent <= this._outlines.length) {\n      // the user provided a valid index number: use it as the parentIndex\n      parentIndex = parent\n    } else {\n      // the user did not provide a valid index number: search for it in the outline array\n      // if it is not found, create the corresponding parent at root level\n      if (parent === undefined || parent === '') {\n        parentIndex = 0\n      } else {\n        parentIndex = this._outlines.findIndex(\n          (item, index) => (item.data.title === parent)\n        )\n        if (parentIndex === -1) parentIndex = this.outline(parent, destination)\n      }\n    }\n\n    // Find siblings\n    let siblingsIndexes = this._outlines.reduce((result, item, index) => {\n      if (index !== 0 && item.data.parentIndex === parentIndex) result.push(index)\n      return result\n    }, [])\n\n    // Create item\n    const outline = new PDF.Object()\n    outline.data = {title, destination, parent}\n    outline.prop('Title', new PDF.String(title))\n    outline.prop('Parent', this._outlines[parentIndex].toReference())\n    outline.prop('A', new PDF.Dictionary({\n      S: 'GoTo',\n      D: new PDF.String(destination),\n    }))\n    this._registerObject(outline)\n    const outlineIndex = this._outlines.push(outline)-1\n\n    // Chain to siblings\n    const prevSiblingIndex = siblingsIndexes[siblingsIndexes.length-1]\n    if (prevSiblingIndex > 0) {\n      // Next\n      this._outlines[prevSiblingIndex].data.nextId = outlineIndex\n      this._outlines[prevSiblingIndex].prop('Next', this._outlines[outlineIndex].toReference())\n      // Prev\n      this._outlines[outlineIndex].data.prevId = prevSiblingIndex\n      this._outlines[outlineIndex].prop('Prev', this._outlines[prevSiblingIndex].toReference())\n    }\n\n    // Chain to parents\n    this._outlines[outlineIndex].data.parentIndex = parentIndex\n    if (siblingsIndexes.length === 0) {\n      // First\n      this._outlines[parentIndex].data.firstIndex = outlineIndex\n      this._outlines[parentIndex].prop('First', this._outlines[outlineIndex].toReference())\n    }\n    // Last\n    this._outlines[parentIndex].data.lastIndex = outlineIndex\n    this._outlines[parentIndex].prop('Last', this._outlines[outlineIndex].toReference())\n    // Count(s)\n    this._updateOutlinesCount(parentIndex)\n\n    return outlineIndex\n  }\n}\n\nObject.assign(Document.prototype, {\n    _begin: Fragment.prototype._begin,\n    _end: Fragment.prototype._end,\n    _opts: Fragment.prototype._opts,\n\n    text: Fragment.prototype.text,\n    cell: Fragment.prototype.cell,\n    table: Fragment.prototype.table,\n    image: Fragment.prototype.image,\n    pageBreak: Fragment.prototype.pageBreak,\n    op: Fragment.prototype.op,\n    destination: Fragment.prototype.destination,\n  })\n\nclass AliasGenerator {\n  constructor() {\n    this.nextId = {}\n    this.blocked = new Set()\n  }\n\n  next(prefix) {\n    if (!(prefix in this.nextId)) {\n      this.nextId[prefix] = 1\n    }\n\n    let next\n    do {\n      next = prefix + this.nextId[prefix]++\n    } while (this.blocked.has(next))\n\n    return next\n  }\n\n  block(alias) {\n    alias = String(alias)\n    if (alias[0] === '/') {\n      alias = alias.slice(1)\n    }\n\n    this.blocked.add(alias)\n  }\n\n  isBlocked(alias) {\n    alias = String(alias)\n    if (alias[0] === '/') {\n      alias = alias.slice(1)\n    }\n\n    return this.blocked.has(alias)\n  }\n\n  reset(prefix) {\n    this.nextId[prefix] = 1\n  }\n}\n\nmodule.exports = Document\n"]},"metadata":{},"sourceType":"script"}